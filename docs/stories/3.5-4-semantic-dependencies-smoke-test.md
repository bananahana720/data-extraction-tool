# Story 3.5.4: Semantic Dependencies + Smoke Test

Status: backlog

## Story

As a developer preparing to implement Epic 4 semantic analysis features,
I want scikit-learn, joblib, and textstat installed and validated with smoke tests,
so that TF-IDF/LSA/readability infrastructure is proven ready with <100ms baseline before semantic development starts.

### Story Header

- **Story Key:** `3.5-4-semantic-dependencies-smoke-test` (Epic 3.5, Story ID 3.5.4)
- **Context:** Epic 4 cannot start without classical NLP libraries validated and baselined. [Source: docs/retrospectives/epic-3-retro-2025-11-16.md#L40-L44]
- **Dependencies:** None (foundation for Stories 3.5.5-3.5.7)
- **Estimate:** 4 hours
- **Owner:** Charlie

### Story Body

Implementation will add scikit-learn (≥1.3.0), joblib (≥1.3.0), and textstat (≥0.7.3) to `pyproject.toml` dependencies, create a smoke test script (`scripts/smoke-test-semantic.py`) that validates TF-IDF fit/transform, LSA (TruncatedSVD), cosine similarity, and textstat readability metrics, and integrate the smoke test into CI workflows. The smoke test must establish performance baseline: TF-IDF fit/transform <100ms on 1k-word document. CI cache configuration must be updated to cache scikit-learn models for faster builds. [Source: docs/retrospectives/epic-3-retro-2025-11-16.md#L55-L56]

## Acceptance Criteria

1. **Dependencies installed:** `pyproject.toml` includes scikit-learn ≥1.3.0, joblib ≥1.3.0, textstat ≥0.7.3 with version constraints. [Source: docs/tech-spec-epic-3.5.md#L141-L148]
2. **Smoke test script:** `scripts/smoke-test-semantic.py` validates TF-IDF vectorization, LSA dimensionality reduction, textstat metrics. [Source: docs/tech-spec-epic-3.5.md#L150-L175]
3. **Performance baseline:** TF-IDF fit/transform completes in <100ms on 1k-word document (10 docs corpus). [Source: docs/tech-spec-epic-3.5.md#L151-L165]
4. **CI integration:** Smoke test runs in GitHub Actions workflow, fails build if tests don't pass. [Source: docs/tech-spec-epic-3.5.md#L177-L182]
5. **CI caching:** GitHub Actions caches scikit-learn dependencies for faster builds (similar to spaCy caching pattern). [Source: docs/retrospectives/epic-3-retro-2025-11-16.md#L55]
6. **Documentation:** CLAUDE.md updated with semantic dependencies setup instructions and smoke test usage. [Source: docs/tech-spec-epic-3.5.md#L226-L230]

## Tasks / Subtasks

- [ ] **Task 1: Install dependencies (AC: 1)**
  - [ ] Add scikit-learn, joblib, textstat to `pyproject.toml` with version constraints
  - [ ] Run `pip install -e ".[dev]"` to verify installation
  - [ ] Document dependency rationale (TF-IDF/LSA/readability for Epic 4)
  - [ ] Update requirements documentation if needed

- [ ] **Task 2: Create smoke test script (AC: 2-3)**
  - [ ] Create `scripts/smoke-test-semantic.py` with TF-IDF performance test (<100ms)
  - [ ] Add LSA (TruncatedSVD) dimensionality reduction test
  - [ ] Add textstat Flesch reading ease test
  - [ ] Add cosine similarity test
  - [ ] Ensure script exits with non-zero code on failures
  - [ ] Add informative output messages for each test

- [ ] **Task 3: CI integration (AC: 4-5)**
  - [ ] Add smoke test step to `.github/workflows/test.yml`
  - [ ] Configure scikit-learn dependency caching in GitHub Actions
  - [ ] Test CI workflow with smoke test integration
  - [ ] Verify cache reduces build time

- [ ] **Task 4: Documentation and validation (AC: 6)**
  - [ ] Update CLAUDE.md with semantic dependencies section
  - [ ] Document smoke test usage and expected output
  - [ ] Add troubleshooting guidance for common dependency issues
  - [ ] Link to test-dependency-audit.md process (Story 3.5.3)

## Dev Notes

### Requirements Context Summary

- **Retrospective prep task #1:** Add scikit-learn, joblib, textstat; smoke script validating TF-IDF + textstat (4h, Charlie). [Source: docs/retrospectives/epic-3-retro-2025-11-16.md#L55-L56]
- **Epic 4 blocker:** Cannot build semantic processor without validated dependencies and performance baselines. [Source: docs/tech-spec-epic-3.5.md#L45-L67]
- **Enterprise constraint:** Classical NLP only – no transformer models allowed. [Source: .claude/CLAUDE.md#enterprise-constraint]

### Structure Alignment Summary

- Follows Epic 2.5.2 spaCy integration pattern: install → smoke test → CI caching → documentation.
- Smoke test script mirrors `python -m spacy validate` approach with performance assertions.
- Dependencies support Epic 4 stories: TF-IDF (4.1), LSA (4.2), textstat quality metrics (4.4).

### References

- `docs/retrospectives/epic-3-retro-2025-11-16.md#L55-L56` – Preparation sprint task #1
- `docs/tech-spec-epic-3.5.md#L141-L182` – Semantic dependencies architecture
- `.claude/CLAUDE.md#spacy-model-setup` – Similar dependency setup pattern
- `docs/stories/2.5-2-spacy-integration-and-end-to-end-testing.md` – spaCy smoke test example

## Dev Agent Record

### Context Reference

- docs/retrospectives/epic-3-retro-2025-11-16.md
- docs/tech-spec-epic-3.5.md
- .claude/CLAUDE.md

### Agent Model Used

claude-sonnet-4-5-20250929

### Debug Log References

Session 2025-11-17: Story 3.5.4 drafted from Epic 3.5 tech spec and retrospective preparation tasks.

### Completion Notes List

- **2025-11-17:** Story created with 6 ACs, 4 task groups, references to retrospective and tech spec.

### File List

**Created:**
- `docs/stories/3.5-4-semantic-dependencies-smoke-test.md` (this document)
