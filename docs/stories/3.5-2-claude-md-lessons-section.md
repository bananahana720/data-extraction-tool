# Story 3.5.2: CLAUDE.md Lessons Section

Status: todo - Ready for implementation (Epic 3.5 - Bridge Epic)

## Story

As a **developer or Claude Code working on data-extraction-tool**,
I want **a dedicated Lessons Learned section in CLAUDE.md documenting epic retrospective insights**,
so that **I can avoid repeating past mistakes and leverage proven patterns from previous epics**.

## Context Summary

**Epic Context:** Story 3.5.2 is part of Epic 3.5 (Bridge Epic - Tooling & Semantic Prep), which prepares the project for Epic 4 (Foundational Semantic Analysis). This story addresses a pending action item from the Epic 2 retrospective that was carried forward: "CLAUDE.md lessons section (Owner: Bob)."

**Business Value:**
- Prevents repeating mistakes by documenting what didn't work (e.g., "AC evidence backfilled post-review")
- Amplifies successes by documenting what worked well (e.g., "Organizer + OutputWriter unified delivery")
- Accelerates onboarding for new team members or AI agents by providing historical context
- Creates institutional memory that survives team changes
- Reduces cognitive load by making lessons immediately accessible in CLAUDE.md (no need to search retrospectives)

**Dependencies:**
- **Epic 3 Complete (Chunk & Output)** - All 7 stories completed, retrospective complete
- **Epic 3 Retrospective (2025-11-16)** - Source for lessons learned, successes, challenges
- **Epic 2 Retrospective** - Pending action item carried forward
- **CLAUDE.md** - Main project guidance file for Claude Code

**Technical Foundation:**
- **CLAUDE.md structure** - Markdown with clear sections, currently lacks Lessons Learned section
- **Retrospective format** - Retrospectives in docs/retrospectives/ provide source material
- **Pattern language** - Document lessons as actionable patterns (Do X, Avoid Y, Consider Z)

**Key Requirements:**
1. **New Section:** Add "## Lessons Learned" section to CLAUDE.md
2. **Epic-Organized:** Group lessons by epic (Epic 1, Epic 2, Epic 3, Epic 2.5)
3. **Actionable Patterns:** Frame lessons as actionable do/avoid/consider statements
4. **Examples:** Include concrete examples from actual stories to illustrate lessons
5. **Living Document:** Section is append-only (add Epic 4+ lessons later)

## Acceptance Criteria

**AC-3.5.2-1: Lessons Learned Section Added to CLAUDE.md (P0 - Critical)**
- New section "## Lessons Learned" added after "## Key Architecture Decisions" in CLAUDE.md
- Section includes:
  - Introduction explaining purpose ("Lessons from epic retrospectives to guide development")
  - Subsections for each completed epic (Epic 1, Epic 2, Epic 2.5, Epic 3)
  - Format: "### Epic X: [Epic Title] - [Key Theme]"
- Each epic subsection contains 3-5 key lessons in pattern language format:
  - **Do:** Actionable practices that worked well
  - **Avoid:** Anti-patterns or mistakes to prevent
  - **Consider:** Context-dependent trade-offs or considerations
- **Validation:** Manual review of CLAUDE.md structure, readability
- **UAT Required:** Yes - Team reviews section, confirms lessons are clear and actionable

**AC-3.5.2-2: Epic 3 Lessons Documented (P0)**
- Epic 3 subsection includes lessons extracted from Epic 3 retrospective (2025-11-16):
  - **Do:** Document AC evidence during implementation (not post-review)
  - **Do:** Use unified infrastructure patterns (OutputWriter + Organizer success)
  - **Do:** Create bridge epics for preparation work (Epic 2.5 success)
  - **Avoid:** Backfilling AC evidence tables after review (causes rework)
  - **Avoid:** Deferring preparation tasks until mid-sprint (causes blockers)
  - **Consider:** Investing in scriptable scaffolding to embed guidelines (template generator)
- Each lesson includes concrete example from Epic 3 stories:
  - Example: "Story 3.7 unified OutputWriter with Organizer, avoiding duplicate logic"
- **Validation:** Cross-reference with Epic 3 retrospective document
- **UAT Required:** Yes - Epic 3 participants validate accuracy

**AC-3.5.2-3: Epic 2 and Epic 2.5 Lessons Documented (P1)**
- Epic 2 subsection includes lessons from Extract & Normalize stage:
  - **Do:** Establish performance baselines early (Story 2.5.1 success)
  - **Do:** Use frozen dataclasses for pipeline immutability (ADR-001)
  - **Avoid:** Skipping brownfield assessment (Epic 1 lesson applied)
- Epic 2.5 subsection includes infrastructure lessons:
  - **Do:** Automate quality gates with pre-commit (Story 2.5.3)
  - **Do:** Create UAT workflow framework for systematic validation (Story 2.5.3.1)
  - **Do:** Profile before optimizing (Story 2.5.2.1 performance work)
  - **Consider:** Bridge epics for cross-cutting concerns (Epic 2.5 itself)
- **Validation:** Cross-reference with retrospective documents (if available)
- **UAT Required:** No - Can infer from story documentation and CLAUDE.md existing content

**AC-3.5.2-4: Epic 1 Lessons Documented (P1)**
- Epic 1 subsection includes foundation lessons:
  - **Do:** Assess brownfield code before greenfield work (Story 1.2 success)
  - **Do:** Establish testing framework and CI early (Story 1.3)
  - **Do:** Define core architecture patterns upfront (Story 1.4)
  - **Avoid:** Starting greenfield without understanding brownfield (prevented tech debt)
- **Validation:** Review Epic 1 stories and tech spec
- **UAT Required:** No - Historical lessons, less critical

**AC-3.5.2-5: Section Formatted for Claude Code Consumption (P0)**
- Lessons written in clear, directive language optimized for LLM parsing
- Use consistent pattern language (Do/Avoid/Consider) for easy scanning
- Include references to specific stories, ADRs, or retrospectives for context
- Use markdown formatting (bold for emphasis, code blocks for examples)
- Section length: 200-400 lines (substantial but not overwhelming)
- **Validation:** Test with Claude Code - ask "What lessons did Epic 3 teach us?"
- **UAT Required:** Yes - Validate Claude Code can extract relevant lessons

## Acceptance Criteria Trade-offs and Deferrals

**AC-3.5.2-3 and AC-3.5.2-4 Trade-off (Epic 1/2 Detail):**
- **Issue:** Epic 1 and Epic 2 retrospectives may not exist or be as detailed as Epic 3
- **Resolution:** Infer lessons from story documentation, tech specs, and existing CLAUDE.md content
- **Rationale:** Best-effort historical lessons better than none; Epic 3+ will be more detailed
- **Documented In:** Dev Notes

**No Deferrals:** All ACs are foundational for Epic 4 preparation.

## Tasks / Subtasks

### Task 1: Extract Lessons from Retrospectives (AC: #3.5.2-2, #3.5.2-3, #3.5.2-4)
- [ ] Read Epic 3 retrospective (docs/retrospectives/epic-3-retro-2025-11-16.md)
- [ ] Extract 5-7 key lessons from Successes, Challenges, Key Insights sections
- [ ] Identify Epic 2.5 lessons from docs/retrospectives/ (if exists) or infer from stories
- [ ] Identify Epic 2 lessons from story docs (2-X stories) and tech-spec-epic-2.md (if exists)
- [ ] Identify Epic 1 lessons from story docs (1-X stories) and tech-spec-epic-1.md
- [ ] Organize lessons by Do/Avoid/Consider categories
- [ ] Link lessons to specific stories, ADRs, or retrospectives

### Task 2: Write Epic 3 Lessons Section (AC: #3.5.2-2)
- [ ] Create "### Epic 3: Chunk & Output - Documentation & Unified Infrastructure" subsection
- [ ] Document "Do" patterns with examples:
  - AC evidence during implementation (Story 3.4-3.7 success)
  - Unified infrastructure (OutputWriter + Organizer, Story 3.7)
  - Bridge epics for preparation (Epic 2.5 â†’ Epic 3)
- [ ] Document "Avoid" anti-patterns with examples:
  - Backfilling AC evidence post-review (Epic 3 challenge)
  - Deferring prep tasks (Epic 3 retro action items)
- [ ] Document "Consider" trade-offs:
  - Investing in scaffolding vs manual enforcement (Story 3.5.1)
- [ ] Add cross-references to Epic 3 stories and retrospective

### Task 3: Write Epic 2 and Epic 2.5 Lessons Sections (AC: #3.5.2-3)
- [ ] Create "### Epic 2: Extract & Normalize - Performance Baselines & Immutability" subsection
- [ ] Document Epic 2 lessons (inferred from stories):
  - Performance baselines early (Story 2.5.1)
  - Frozen dataclasses (ADR-001, stories 2.1-2.6)
- [ ] Create "### Epic 2.5: Infrastructure & Optimization - Automation & UAT" subsection
- [ ] Document Epic 2.5 lessons:
  - Quality gate automation (Story 2.5.3, pre-commit)
  - UAT workflow framework (Story 2.5.3.1)
  - Profile before optimize (Story 2.5.2.1)

### Task 4: Write Epic 1 Lessons Section (AC: #3.5.2-4)
- [ ] Create "### Epic 1: Foundation - Brownfield Assessment & Architecture" subsection
- [ ] Document Epic 1 lessons:
  - Brownfield assessment before greenfield (Story 1.2)
  - Testing framework early (Story 1.3)
  - Core architecture patterns upfront (Story 1.4)
- [ ] Add cross-references to Epic 1 stories and ADRs

### Task 5: Add Section to CLAUDE.md (AC: #3.5.2-1)
- [ ] Open .claude/CLAUDE.md in editor
- [ ] Locate "## Key Architecture Decisions" section
- [ ] Add new "## Lessons Learned" section after ADRs
- [ ] Add introduction explaining purpose and structure
- [ ] Insert Epic 1, Epic 2, Epic 2.5, Epic 3 subsections
- [ ] Format with consistent markdown (headings, bold, code blocks)
- [ ] Verify total section length is 200-400 lines
- [ ] Save file

### Task 6: Validate with Claude Code (AC: #3.5.2-5)
- [ ] Test query: "What lessons did Epic 3 teach us about AC evidence?"
- [ ] Verify Claude Code extracts relevant lessons from new section
- [ ] Test query: "What anti-patterns should I avoid based on Epic 2?"
- [ ] Verify Claude Code can navigate Do/Avoid/Consider structure
- [ ] Adjust formatting if Claude Code struggles to parse

### Task 7: Quality Gates and UAT
- [ ] Manual review of CLAUDE.md - check readability, formatting, length
- [ ] Cross-reference lessons with retrospective documents for accuracy
- [ ] UAT: Team reviews Lessons Learned section (AC-3.5.2-1)
- [ ] UAT: Epic 3 participants validate Epic 3 lessons (AC-3.5.2-2)
- [ ] UAT: Claude Code test queries (AC-3.5.2-5)

## Dev Notes

**Provenance Tracking:**
- CLAUDE.md is a documentation file, not pipeline output (no source_hash needed)
- Lessons include timestamps via retrospective dates (e.g., "Epic 3 retro 2025-11-16")
- Each lesson should reference source (story ID, ADR number, retrospective date)

**Structured Logging:**
- No structured logging needed (documentation update, not pipeline operation)
- Git commit message should reference Story 3.5.2 and Epic 3.5

**Pipeline Wiring:**
- Not applicable (documentation update, not code change)

**Quality Gates:**
- No code quality gates (no Python code)
- Manual review for:
  - Markdown formatting correctness
  - Link validity (story references, ADR references)
  - Spelling and grammar
  - Section length (200-400 lines target)

**Testing Strategy:**
- Manual review by team (UAT-3.5.2-1, UAT-3.5.2-2)
- Claude Code parsing test (UAT-3.5.2-5)
- Cross-reference validation with retrospectives

**Pattern Language Reference:**
- **Do:** Positive actions that worked well (repeat these)
- **Avoid:** Anti-patterns or mistakes to prevent (don't repeat these)
- **Consider:** Context-dependent trade-offs (use judgment)

**Example Lesson Format:**
```markdown
**Do: Document AC Evidence During Implementation**
- Collect evidence as you complete ACs, not during review (Epic 3 challenge)
- Use AC evidence tables in story files (see Story 3.4-3.7 examples)
- Example: Story 3.7 had complete evidence tables before review (no rework)
- Reference: Epic 3 Retrospective 2025-11-16, Challenge #2
```

**CLAUDE.md Section Structure:**
```markdown
## Lessons Learned

This section documents lessons from epic retrospectives to guide development and avoid repeating mistakes.

### Epic 1: Foundation - Brownfield Assessment & Architecture
[Lessons here...]

### Epic 2: Extract & Normalize - Performance Baselines & Immutability
[Lessons here...]

### Epic 2.5: Infrastructure & Optimization - Automation & UAT
[Lessons here...]

### Epic 3: Chunk & Output - Documentation & Unified Infrastructure
[Lessons here...]
```

**Retrospective Sources:**
- Epic 3: docs/retrospectives/epic-3-retro-2025-11-16.md (primary source)
- Epic 2.5: Infer from stories 2.5-1 through 2.5-6
- Epic 2: Infer from stories 2-1 through 2-6
- Epic 1: Infer from stories 1-1 through 1-4

**Cross-References to Add:**
- Story IDs (e.g., "Story 3.7 unified OutputWriter")
- ADR numbers (e.g., "ADR-001 immutable models")
- Retrospective dates (e.g., "Epic 3 retro 2025-11-16")
- Tech spec sections (e.g., "tech-spec-epic-3.md Section 4")

**Estimated Section Length:**
- Introduction: ~20 lines
- Epic 1 lessons: ~40 lines (3-4 lessons)
- Epic 2 lessons: ~50 lines (4-5 lessons)
- Epic 2.5 lessons: ~60 lines (5-6 lessons)
- Epic 3 lessons: ~80 lines (6-7 lessons)
- Total: ~250 lines (within 200-400 target)

**Retrospective Learnings Applied:**
- This story directly addresses "CLAUDE.md lessons section (Owner: Bob, Deadline: 2025-11-21)"
- Documents Epic 3 insight: "Invest in scriptable scaffolding to embed guidelines"
- Documents Epic 3 challenge: "AC evidence often backfilled post-review, causing rework"
- Creates institutional memory per Epic 3 insight: "Enforce completion via tooling"

**Next Story Dependencies:**
- Story 3.5.3+ can reference lessons from this section
- Epic 4 stories will add Epic 4 lessons to this section (living document)
