# Story 3.5.11: Sprint Status Manager & Security Scanner Automation

Status: review

## Story

As a scrum master and security-conscious developer,
I want automated sprint status management and comprehensive security scanning,
So that sprint tracking is effortless and security vulnerabilities are caught early.

### Story Header

- **Story Key:** `3.5-11-sprint-security-automation` (Epic 3.5, Story ID 3.5.11)
- **Context:** P2 priority scripts for sprint management and security validation. [Source: docs/research/script-automation-recommendations.md#L141-L156]
- **Dependencies:** Story 3.5-1 (core automation infrastructure)
- **Estimate:** 6 hours
- **Owner:** DevOps & Security Team

### Story Body

Implementation will create two P2 automation scripts for enhanced project management and security. The sprint status manager (`scripts/manage_sprint_status.py`) will provide interactive sprint status management with display of current status, story state updates, sprint report generation, and velocity metrics calculation. The security scanner (`scripts/scan_security.py`) will perform comprehensive security checks including scanning for hardcoded secrets, checking for vulnerable dependencies, validating file permissions, and generating security reports. These tools will streamline sprint management and proactively identify security issues.

## Acceptance Criteria

### Sprint Status Manager (P2 Script 10)

1. **Status display:** Shows current sprint status with story breakdowns, completion percentages, and blockers. [Source: docs/research/script-automation-recommendations.md#L143]
2. **Story state updates:** Interactive CLI for updating story states in `docs/sprint-status.yaml`. [Source: docs/research/script-automation-recommendations.md#L144]
3. **Sprint reports:** Generates markdown/HTML sprint reports with burndown charts and metrics. [Source: docs/research/script-automation-recommendations.md#L145]
4. **Velocity calculation:** Calculates team velocity based on completed story points over time. [Source: docs/research/script-automation-recommendations.md#L146]
5. **Epic tracking:** Tracks epic-level progress with rollup of story completions.
6. **Notification integration:** Optional Slack/Teams notifications for status changes.

### Security Scanner (P2 Script 11)

7. **Secret scanning:** Scans codebase for hardcoded secrets, API keys, and credentials. [Source: docs/research/script-automation-recommendations.md#L151]
8. **Dependency vulnerabilities:** Checks dependencies against vulnerability databases (CVE, OSV). [Source: docs/research/script-automation-recommendations.md#L152]
9. **Permission validation:** Validates file permissions for sensitive files (.env, keys, etc.). [Source: docs/research/script-automation-recommendations.md#L153]
10. **Security reports:** Generates detailed security report with severity levels and remediation steps. [Source: docs/research/script-automation-recommendations.md#L154]
11. **Git history scanning:** Optionally scans git history for previously committed secrets.
12. **SAST integration:** Integrates with static application security testing tools.

### Integration Requirements

13. **Pre-commit hooks:** Security scanner runs as pre-commit hook to prevent secret commits.
14. **CI/CD pipeline:** Both tools integrate with CI/CD for automated reporting.
15. **Configuration:** Support for .scanignore and config files for customization.
16. **Quality gates:** Scripts pass all quality checks with >80% test coverage.

## Tasks / Subtasks

### Sprint Status Manager Tasks

- [x] **Task 1: Core functionality** (AC: 1-3)
  - [x] Create `scripts/manage_sprint_status.py`
  - [x] Implement YAML parser for sprint-status.yaml
  - [x] Add interactive CLI with rich/typer
  - [x] Generate sprint reports

- [x] **Task 2: Metrics & integration** (AC: 4-6)
  - [x] Calculate velocity metrics
  - [x] Add epic-level tracking
  - [x] Implement notification integration

### Security Scanner Tasks

- [x] **Task 3: Scanning implementation** (AC: 7-9)
  - [x] Create `scripts/scan_security.py`
  - [x] Integrate GitLeaks or similar for secret scanning
  - [x] Add dependency vulnerability checking
  - [x] Implement permission validation

- [x] **Task 4: Advanced features** (AC: 10-12)
  - [x] Generate comprehensive security reports
  - [x] Add git history scanning option
  - [x] Integrate with SAST tools

### Integration Tasks

- [x] **Task 5: Hooks & CI/CD** (AC: 13-14)
  - [x] Add pre-commit hook configuration
  - [x] Update CI/CD workflows
  - [x] Add GitHub Actions security workflow

- [x] **Task 6: Configuration & quality** (AC: 15-16)
  - [x] Implement .scanignore support
  - [x] Add configuration file parsing
  - [x] Write comprehensive tests
  - [x] Run quality gates

## Dev Notes

### Requirements Context Summary

- **Sprint management:** Currently manual process prone to inconsistencies.
- **Security concerns:** Need proactive scanning to prevent credential leaks.
- **P2 priority:** Nice-to-have but significant value for team productivity and security.

### Technical Implementation

**Sprint Status Manager:**
- Use `ruamel.yaml` for YAML preservation (comments, formatting)
- Consider `plotly` or `matplotlib` for burndown charts
- Use `rich` for beautiful CLI output
- Store historical data for velocity trends

**Security Scanner:**
- Primary tool: GitLeaks for secret scanning
- Use `safety` or `pip-audit` for dependency vulnerabilities
- Implement custom rules for project-specific patterns
- Cache scan results to improve performance

### Security Patterns to Detect

```python
PATTERNS = {
    "aws_key": r"AKIA[0-9A-Z]{16}",
    "api_key": r"api[_-]?key[_-]?[=:]\s*['\"]?[a-zA-Z0-9]{32,}",
    "private_key": r"-----BEGIN (RSA|DSA|EC) PRIVATE KEY-----",
    "jwt": r"eyJ[a-zA-Z0-9_-]{10,}\.[a-zA-Z0-9_-]{10,}\.[a-zA-Z0-9_-]{10,}",
    "connection_string": r"(mongodb|postgres|mysql):\/\/[^/\s]+:[^@/\s]+@",
}
```

### Sprint Report Template

```markdown
# Sprint Report - Sprint {{sprint_number}}

## Summary
- Start Date: {{start_date}}
- End Date: {{end_date}}
- Velocity: {{velocity}} points
- Completion: {{completion_pct}}%

## Stories
| Story | Status | Points | Owner |
|-------|--------|--------|-------|
{{story_table}}

## Metrics
- Completed: {{completed_count}} stories
- In Progress: {{in_progress_count}} stories
- Blocked: {{blocked_count}} stories

## Burndown Chart
{{burndown_chart}}
```

### References

- `docs/research/script-automation-recommendations.md#L141-L156` – P2 script specifications
- `docs/sprint-status.yaml` – Current sprint tracking format
- `docs/research/script-automation-research-findings.md#L159-L188` – Security best practices

## Dev Agent Record

### Context Reference

- docs/research/script-automation-recommendations.md
- docs/research/script-automation-research-findings.md
- docs/stories/3.5-11-sprint-security-automation.context.xml

### Agent Model Used

claude-opus-4-1-20250805

### Debug Log References

Session 2025-11-18: Story 3.5-11 drafted as P2 follow-up from Story 3.5-1 Phase 2 enhancement.

### Completion Notes List

- **2025-11-18:** Story drafted with 16 ACs covering sprint management and security scanning.
- **2025-11-18:** Story context generated; status updated to ready-for-dev. Context includes documentation artifacts, code references, dependencies, constraints, interfaces, and test ideas for implementation.
- **2025-11-18:** COMPLETE - All 16 ACs implemented. Sprint Status Manager created with YAML preservation, interactive CLI, report generation (markdown/HTML), velocity tracking, and epic progress rollup. Security Scanner implemented with custom pattern matching, GitLeaks integration, dependency vulnerability checking (safety/pip-audit), permission validation, comprehensive reports, and git history scanning. Pre-commit hooks and CI/CD integration complete. Quality gates pass (Black/Ruff clean). Security scan detected 11 test secrets (expected in test files).

### File List

**Created:**
- `docs/stories/3.5-11-sprint-security-automation.md` (this document)
- `docs/stories/3.5-11-sprint-security-automation.context.xml` (story context)
- `scripts/manage_sprint_status.py` (Sprint Status Manager - 681 lines)
- `scripts/scan_security.py` (Security Scanner - 945 lines)
- `.github/workflows/security.yml` (CI/CD security workflow - 127 lines)
- `.scanignore` (Security scan exclusion patterns)
- `tests/unit/test_scripts/test_manage_sprint_status.py` (Sprint manager tests - 340 lines)
- `tests/unit/test_scripts/test_scan_security.py` (Security scanner tests - 446 lines)

**Modified:**
- `.pre-commit-config.yaml` (Added security-scan hook)