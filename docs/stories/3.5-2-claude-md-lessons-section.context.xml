<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>3.5</epicId>
    <storyId>3.5.2</storyId>
    <title>CLAUDE.md Lessons Section</title>
    <status>backlog</status>
    <generatedAt>2025-11-17</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/3.5-2-claude-md-lessons-section.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>AI development agent working on this codebase</asA>
    <iWant>a consolidated "Lessons & Reminders" section in CLAUDE.md (≤100 lines)</iWant>
    <soThat>critical guidelines from Epic 1-3 retrospectives are visible every session and referenced by template scripts</soThat>
    <tasks>
      - Task 1: Extract lessons from retrospectives (AC: 1, 3)
        - Read Epic 1 retrospective, extract key lessons
        - Read Epic 2 retrospective, extract key lessons
        - Read Epic 3 retrospective, extract key lessons
        - Organize into Story Development, Code Quality, Testing, Documentation categories
      - Task 2: Write consolidated section (AC: 2, 5)
        - Draft "Lessons & Reminders" section in CLAUDE.md
        - Ensure each guideline is specific and actionable
        - Verify word count ≤100 lines
        - Review for clarity and scannability
      - Task 3: Integration and validation (AC: 4)
        - Coordinate with Story 3.5.1 to reference this section in templates
        - Verify section is visible in CLAUDE.md table of contents
        - QA review for completeness and accuracy
    </tasks>
  </story>

  <acceptanceCriteria>
    AC-1: Section exists - CLAUDE.md contains "Lessons & Reminders" section with Epic 1-3 consolidated learnings [Source: docs/tech-spec-epic-3.5.md#L105-L137]

    AC-2: Word count - Section is ≤100 lines (excluding section header), concise and scannable [Source: docs/retrospectives/epic-3-retro-2025-11-16.md#L49]

    AC-3: Coverage areas - Includes subsections for Story Development, Code Quality, Testing, Documentation per tech spec template [Source: docs/tech-spec-epic-3.5.md#L105-L137]

    AC-4: Referenced by scripts - Story template generator (Story 3.5.1) references this section in generated story files [Source: docs/tech-spec-epic-3.5.md#L137]

    AC-5: Actionable content - Each guideline is specific and actionable (e.g., "Run mypy from project root", "Fill AC table before review status") [Source: docs/retrospectives/epic-3-retro-2025-11-16.md#L26-L30]
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <entry>
        <path>docs/retrospectives/epic-1-retro-20251110.md</path>
        <title>Epic 1 Foundation Retrospective</title>
        <section>Lessons Learned</section>
        <snippet>Protocol-based design > ABC inheritance. Continue-on-error pattern requires comprehensive exception hierarchy. Test fixtures require path-agnostic implementation using Path(__file__).parent. Code review cycles are teaching moments, not failures. Honest assessment enables realistic planning.</snippet>
      </entry>
      <entry>
        <path>docs/retrospectives/epic-2-retro-20250111.md</path>
        <title>Epic 2 Extract & Normalize Retrospective</title>
        <section>Lessons Learned</section>
        <snippet>Automation beats documentation for quality enforcement - humans forget manual steps under pressure. PipelineStage protocol scales without friction. Test coverage growth validates architecture investment (88 tests → 307 tests, zero regressions). Integration stories need extra validation (100% coverage on integration code). Bridge epics prevent downstream blockers.</snippet>
      </entry>
      <entry>
        <path>docs/retrospectives/epic-2.5-retro-2025-11-13.md</path>
        <title>Epic 2.5 Bridge Retrospective</title>
        <section>Anti-Patterns to Avoid</section>
        <snippet>"Done" means quality gates pass, not just functionality works. Run Black → Ruff → Mypy → Tests before marking tasks complete. Architecture validation before implementation (not after). Profile-driven development: measure before optimizing. Documentation should be concise with links to detailed docs (bullet points > paragraphs).</snippet>
      </entry>
      <entry>
        <path>docs/retrospectives/epic-3-retro-2025-11-16.md</path>
        <title>Epic 3 Intelligent Chunking Retrospective</title>
        <section>Lessons & Insights</section>
        <snippet>Automation > Memory - template/scripts must encode development guidelines (BOM, logging, wiring, stakeholder checklists) so humans cannot omit them. Evidence-first reviews: AC matrices, log excerpts, and perf numbers should be captured before "ready-for-review". Documentation is a deliverable with owners/deadlines, not "nice to haves".</snippet>
      </entry>
      <entry>
        <path>docs/tech-spec-epic-3.5.md</path>
        <title>Epic 3.5 Technical Specification</title>
        <section>CLAUDE.md Lessons Section Structure</section>
        <snippet>Format: Markdown with subsections for Story Development (AC evidence table, BOM sections, logging, CLI wiring), Code Quality (mypy execution, immediate violation fixes), Testing (structure mirroring, integration tests for NFRs), Documentation (ADR ownership, performance baselines). Target ≤100 lines, actual ~60 lines.</snippet>
      </entry>
      <entry>
        <path>.claude/CLAUDE.md</path>
        <title>Current CLAUDE.md Structure</title>
        <section>Epic-Based Development</section>
        <snippet>Current structure includes Project Overview, Core Architecture, Development Commands, Testing Strategy, Code Conventions, Epic-Based Development, Configuration, Technology Stack, Epic 3 sections, Quality Gates, Common Tasks, UAT Workflows, Key Architecture Decisions, Documentation References, Important Notes. Missing: Consolidated Lessons & Reminders section.</snippet>
      </entry>
    </docs>

    <code>
      <entry>
        <path>.claude/CLAUDE.md</path>
        <kind>documentation</kind>
        <symbol>Epic-Based Development section</symbol>
        <lines>194-214</lines>
        <reason>Identifies location for new "Lessons & Reminders" section - should be placed after "Epic-Based Development" and before "Configuration" sections for visibility</reason>
      </entry>
      <entry>
        <path>.claude/CLAUDE.md</path>
        <kind>documentation</kind>
        <symbol>Quality Gates section</symbol>
        <lines>648-662</lines>
        <reason>Current quality gates documentation that lessons section will complement and reference</reason>
      </entry>
      <entry>
        <path>.claude/CLAUDE.md</path>
        <kind>documentation</kind>
        <symbol>Pre-commit Enforcement</symbol>
        <lines>148</lines>
        <reason>Existing automation guidance that lessons section should build upon</reason>
      </entry>
    </code>

    <dependencies>
      <python>
        <package name="N/A" version="N/A">This is a documentation-only story with no code dependencies</package>
      </python>
    </dependencies>
  </artifacts>

  <constraints>
    - Section must be ≤100 lines (excluding header) for scannability
    - Must use existing CLAUDE.md formatting conventions (markdown H2/H3 headers, bullet lists, code examples)
    - Placement after "Epic-Based Development" section and before "Configuration" section
    - Each guideline must be actionable and specific (not general platitudes)
    - Must cover all 4 required areas: Story Development, Code Quality, Testing, Documentation
    - Must consolidate lessons from ALL Epic 1-3 retrospectives (not selective)
    - Content should be distilled for project-relevant info only (avoid verbosity per Epic 2.5 lesson)
    - Referenced by Story 3.5.1 template generator (cross-story dependency)
  </constraints>

  <interfaces>
    <entry>
      <name>Story Template Generator Integration</name>
      <kind>Cross-story reference</kind>
      <signature>Story 3.5.1 (scripts/new-story) will reference this CLAUDE.md section in generated story files</signature>
      <path>docs/stories/3.5-1-story-review-template-generator.md</path>
    </entry>
    <entry>
      <name>CLAUDE.md Section Anchor</name>
      <kind>Documentation anchor</kind>
      <signature>## Lessons & Reminders (Epics 1-3) - Must be linkable via anchor for template scripts</signature>
      <path>.claude/CLAUDE.md</path>
    </entry>
  </interfaces>

  <tests>
    <standards>
      This is a documentation story with manual QA validation rather than automated tests. Validation criteria:
      - Manual word count verification (≤100 lines excluding header)
      - Readability review for clarity and scannability
      - Cross-reference all retrospectives to ensure completeness
      - Verify Story 3.5.1 can successfully reference the section
      - QA review for accuracy and actionability of each guideline
    </standards>

    <locations>
      No automated test locations (documentation-only story). QA validation will be documented in story completion notes.
    </locations>

    <ideas>
      - Manual QA Checklist Item 1: Count lines in new section, verify ≤100 lines (AC-2)
      - Manual QA Checklist Item 2: Verify all 4 coverage areas present (Story Development, Code Quality, Testing, Documentation) (AC-3)
      - Manual QA Checklist Item 3: Cross-check each lesson against source retrospective documents for accuracy (AC-1)
      - Manual QA Checklist Item 4: Verify each guideline is actionable (contains specific actions like "Run X", "Fill Y", "Use Z pattern") (AC-5)
      - Manual QA Checklist Item 5: Coordinate with Story 3.5.1 to verify template generator can reference the section (AC-4)
      - Manual QA Checklist Item 6: Review formatting consistency with existing CLAUDE.md patterns (constraint)
      - Manual QA Checklist Item 7: Verify section placement in table of contents (after Epic-Based Development, before Configuration)
    </ideas>
  </tests>
</story-context>
