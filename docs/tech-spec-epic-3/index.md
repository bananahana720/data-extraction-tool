# Technical Specification: Epic 3 - Chunk & Output Stages

## Table of Contents

- [Technical Specification: Epic 3 - Chunk & Output Stages](#table-of-contents)
  - [1. Overview & Scope](./1-overview-scope.md)
    - [Epic Goal](./1-overview-scope.md#epic-goal)
    - [Business Value](./1-overview-scope.md#business-value)
    - [Technical Scope](./1-overview-scope.md#technical-scope)
    - [Dependencies](./1-overview-scope.md#dependencies)
    - [Success Criteria](./1-overview-scope.md#success-criteria)
  - [2. Detailed Design](./2-detailed-design.md)
    - [2.1 Architecture Overview](./2-detailed-design.md#21-architecture-overview)
    - [2.2 Core Services and Modules](./2-detailed-design.md#22-core-services-and-modules)
      - [ChunkingEngine ()](./2-detailed-design.md#chunkingengine)
      - [EntityPreserver ()](./2-detailed-design.md#entitypreserver)
      - [MetadataEnricher ()](./2-detailed-design.md#metadataenricher)
      - [OutputFormatter ()](./2-detailed-design.md#outputformatter)
      - [OrganizationStrategy ()](./2-detailed-design.md#organizationstrategy)
    - [2.3 Data Models](./2-detailed-design.md#23-data-models)
    - [2.4 API Interfaces and Protocols](./2-detailed-design.md#24-api-interfaces-and-protocols)
    - [2.5 Workflow Sequence Diagram](./2-detailed-design.md#25-workflow-sequence-diagram)
  - [3. Non-Functional Requirements](./3-non-functional-requirements.md)
    - [3.1 Performance Requirements](./3-non-functional-requirements.md#31-performance-requirements)
      - [NFR-P1-E3: End-to-End Pipeline Throughput](./3-non-functional-requirements.md#nfr-p1-e3-end-to-end-pipeline-throughput)
      - [NFR-P2-E3: Memory Efficiency](./3-non-functional-requirements.md#nfr-p2-e3-memory-efficiency)
      - [NFR-P3: Chunking Latency](./3-non-functional-requirements.md#nfr-p3-chunking-latency)
      - [NFR-P4: Deterministic Chunking](./3-non-functional-requirements.md#nfr-p4-deterministic-chunking)
    - [3.2 Security Requirements](./3-non-functional-requirements.md#32-security-requirements)
      - [NFR-S1: Data Sanitization in Outputs](./3-non-functional-requirements.md#nfr-s1-data-sanitization-in-outputs)
      - [NFR-S2: No PII Leakage in Metadata](./3-non-functional-requirements.md#nfr-s2-no-pii-leakage-in-metadata)
    - [3.3 Reliability Requirements](./3-non-functional-requirements.md#33-reliability-requirements)
      - [NFR-R1: Continue-on-Error Pattern](./3-non-functional-requirements.md#nfr-r1-continue-on-error-pattern)
      - [NFR-R2: Graceful Degradation](./3-non-functional-requirements.md#nfr-r2-graceful-degradation)
      - [NFR-R3: 100% Traceability](./3-non-functional-requirements.md#nfr-r3-100-traceability)
    - [3.4 Observability Requirements](./3-non-functional-requirements.md#34-observability-requirements)
      - [NFR-O1: Chunking Metrics](./3-non-functional-requirements.md#nfr-o1-chunking-metrics)
      - [NFR-O2: Output Format Metrics](./3-non-functional-requirements.md#nfr-o2-output-format-metrics)
      - [NFR-O3: Quality Score Distributions](./3-non-functional-requirements.md#nfr-o3-quality-score-distributions)
    - [3.5 NFR Summary Table](./3-non-functional-requirements.md#35-nfr-summary-table)
  - [4. Dependencies and Integrations](./4-dependencies-and-integrations.md)
    - [4.1 External Dependencies](./4-dependencies-and-integrations.md#41-external-dependencies)
      - [spaCy 3.7.2+ with en_core_web_md Model](./4-dependencies-and-integrations.md#spacy-372-with-encorewebmd-model)
      - [textstat 0.7.x](./4-dependencies-and-integrations.md#textstat-07x)
      - [Python Standard Library Dependencies](./4-dependencies-and-integrations.md#python-standard-library-dependencies)
    - [4.2 Internal Dependencies (Epic 2 Outputs)](./4-dependencies-and-integrations.md#42-internal-dependencies-epic-2-outputs)
      - [ProcessingResult (Epic 2 Output Model)](./4-dependencies-and-integrations.md#processingresult-epic-2-output-model)
      - [SentenceSegmenter (Epic 2.5.2)](./4-dependencies-and-integrations.md#sentencesegmenter-epic-252)
      - [Entity Normalization (Epic 2 Story 2.2)](./4-dependencies-and-integrations.md#entity-normalization-epic-2-story-22)
    - [4.3 Dependency Version Summary](./4-dependencies-and-integrations.md#43-dependency-version-summary)
    - [4.4 Integration Points](./4-dependencies-and-integrations.md#44-integration-points)
      - [Upstream Integration (Epic 2 → Epic 3)](./4-dependencies-and-integrations.md#upstream-integration-epic-2-epic-3)
      - [Downstream Integration (Epic 3 → Epic 4)](./4-dependencies-and-integrations.md#downstream-integration-epic-3-epic-4)
      - [Downstream Integration (Epic 3 → Epic 5)](./4-dependencies-and-integrations.md#downstream-integration-epic-3-epic-5)
  - [5. Acceptance Criteria & Traceability](./5-acceptance-criteria-traceability.md)
    - [5.1 Story-Level Acceptance Criteria](./5-acceptance-criteria-traceability.md#51-story-level-acceptance-criteria)
      - [Story 3.1: Semantic Boundary-Aware Chunking Engine](./5-acceptance-criteria-traceability.md#story-31-semantic-boundary-aware-chunking-engine)
      - [Story 3.2: Entity-Aware Chunking](./5-acceptance-criteria-traceability.md#story-32-entity-aware-chunking)
      - [Story 3.3: Chunk Metadata and Quality Scoring](./5-acceptance-criteria-traceability.md#story-33-chunk-metadata-and-quality-scoring)
      - [Story 3.4: JSON Output Format with Full Metadata](./5-acceptance-criteria-traceability.md#story-34-json-output-format-with-full-metadata)
      - [Story 3.5: Plain Text Output Format for LLM Upload](./5-acceptance-criteria-traceability.md#story-35-plain-text-output-format-for-llm-upload)
      - [Story 3.6: CSV Output Format for Analysis and Tracking](./5-acceptance-criteria-traceability.md#story-36-csv-output-format-for-analysis-and-tracking)
      - [Story 3.7: Configurable Output Organization Strategies](./5-acceptance-criteria-traceability.md#story-37-configurable-output-organization-strategies)
    - [5.2 Traceability Matrix: Requirements → Components → Tests](./5-acceptance-criteria-traceability.md#52-traceability-matrix-requirements-components-tests)
    - [5.3 NFR Traceability: NFRs → Components → Validation](./5-acceptance-criteria-traceability.md#53-nfr-traceability-nfrs-components-validation)
    - [5.4 UAT Workflow Mapping](./5-acceptance-criteria-traceability.md#54-uat-workflow-mapping)
    - [5.5 Test Type Distribution](./5-acceptance-criteria-traceability.md#55-test-type-distribution)
  - [6. Risks, Assumptions, and Open Questions](./6-risks-assumptions-and-open-questions.md)
    - [6.1 Technical Risks](./6-risks-assumptions-and-open-questions.md#61-technical-risks)
      - [RISK-E3-1: Performance Target Aggressive (10 minutes)](./6-risks-assumptions-and-open-questions.md#risk-e3-1-performance-target-aggressive-10-minutes)
      - [RISK-E3-2: Chunk Quality Subjective and Hard to Validate](./6-risks-assumptions-and-open-questions.md#risk-e3-2-chunk-quality-subjective-and-hard-to-validate)
      - [RISK-E3-3: spaCy Model Accuracy Insufficient for Audit Documents](./6-risks-assumptions-and-open-questions.md#risk-e3-3-spacy-model-accuracy-insufficient-for-audit-documents)
      - [RISK-E3-4: Memory Budget Exceeded (>5.5GB)](./6-risks-assumptions-and-open-questions.md#risk-e3-4-memory-budget-exceeded-55gb)
    - [6.2 Business/Operational Risks](./6-risks-assumptions-and-open-questions.md#62-businessoperational-risks)
      - [RISK-E3-5: Output Formats Don't Meet User Needs](./6-risks-assumptions-and-open-questions.md#risk-e3-5-output-formats-dont-meet-user-needs)
      - [RISK-E3-6: UAT Workflow Overhead Slows Velocity](./6-risks-assumptions-and-open-questions.md#risk-e3-6-uat-workflow-overhead-slows-velocity)
    - [6.3 Assumptions](./6-risks-assumptions-and-open-questions.md#63-assumptions)
      - [ASSUMPTION-E3-1: spaCy Sentence Boundaries Sufficient](./6-risks-assumptions-and-open-questions.md#assumption-e3-1-spacy-sentence-boundaries-sufficient)
      - [ASSUMPTION-E3-2: Three Output Formats Adequate for MVP](./6-risks-assumptions-and-open-questions.md#assumption-e3-2-three-output-formats-adequate-for-mvp)
      - [ASSUMPTION-E3-3: Entity-Aware Chunking Improves Quality](./6-risks-assumptions-and-open-questions.md#assumption-e3-3-entity-aware-chunking-improves-quality)
      - [ASSUMPTION-E3-4: Parallel Output Writes Improve Throughput](./6-risks-assumptions-and-open-questions.md#assumption-e3-4-parallel-output-writes-improve-throughput)
      - [ASSUMPTION-E3-5: textstat Readability Metrics Meaningful for Audit Docs](./6-risks-assumptions-and-open-questions.md#assumption-e3-5-textstat-readability-metrics-meaningful-for-audit-docs)
      - [ASSUMPTION-E3-6: Chunk Size 256-512 Tokens Optimal](./6-risks-assumptions-and-open-questions.md#assumption-e3-6-chunk-size-256-512-tokens-optimal)
    - [6.4 Open Questions](./6-risks-assumptions-and-open-questions.md#64-open-questions)
      - [QUESTION-E3-1: Post-MVP Vector Database Integration?](./6-risks-assumptions-and-open-questions.md#question-e3-1-post-mvp-vector-database-integration)
      - [QUESTION-E3-2: JSON Schema Validation Mandatory or Optional?](./6-risks-assumptions-and-open-questions.md#question-e3-2-json-schema-validation-mandatory-or-optional)
      - [QUESTION-E3-3: Chunk Overlap Strategy: Sentence-Based or Token-Based?](./6-risks-assumptions-and-open-questions.md#question-e3-3-chunk-overlap-strategy-sentence-based-or-token-based)
      - [QUESTION-E3-4: Organization Strategy Default: by_document or flat?](./6-risks-assumptions-and-open-questions.md#question-e3-4-organization-strategy-default-bydocument-or-flat)
      - [QUESTION-E3-5: Manifest Format: JSON, YAML, or CSV?](./6-risks-assumptions-and-open-questions.md#question-e3-5-manifest-format-json-yaml-or-csv)
    - [6.5 Risk Summary Table](./6-risks-assumptions-and-open-questions.md#65-risk-summary-table)
  - [7. Test Strategy](./7-test-strategy.md)
    - [7.1 Test Strategy Overview](./7-test-strategy.md#71-test-strategy-overview)
    - [7.2 Test Categories and Coverage](./7-test-strategy.md#72-test-categories-and-coverage)
      - [Unit Tests (~79 tests)](./7-test-strategy.md#unit-tests-79-tests)
      - [Integration Tests (~48 tests)](./7-test-strategy.md#integration-tests-48-tests)
      - [Performance Tests (~5 tests)](./7-test-strategy.md#performance-tests-5-tests)
      - [UAT Tests (~25 manual/automated validations)](./7-test-strategy.md#uat-tests-25-manualautomated-validations)
    - [7.3 Quality Gates](./7-test-strategy.md#73-quality-gates)
      - [Gate 1: Pre-Commit (0 Violations)](./7-test-strategy.md#gate-1-pre-commit-0-violations)
      - [Gate 2: CI (60% Coverage)](./7-test-strategy.md#gate-2-ci-60-coverage)
      - [Gate 3: UAT (90% Pass Rate)](./7-test-strategy.md#gate-3-uat-90-pass-rate)
    - [7.4 Test Data and Fixtures](./7-test-strategy.md#74-test-data-and-fixtures)
      - [Test Corpus Requirements](./7-test-strategy.md#test-corpus-requirements)
    - [7.5 Test Execution Workflow](./7-test-strategy.md#75-test-execution-workflow)
      - [Local Development (Dev)](./7-test-strategy.md#local-development-dev)
      - [CI Execution (Automated)](./7-test-strategy.md#ci-execution-automated)
      - [UAT Execution (Dev + SM)](./7-test-strategy.md#uat-execution-dev-sm)
    - [7.6 Performance Baseline Documentation](./7-test-strategy.md#76-performance-baseline-documentation)
    - [7.7 Test Strategy Summary](./7-test-strategy.md#77-test-strategy-summary)
  - [Post-Review Follow-ups](./post-review-follow-ups.md)
